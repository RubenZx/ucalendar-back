# Migration `20200915103814`

This migration has been generated by RubenZx at 9/15/2020, 12:38:14 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `ucalendar`.`UserTimeTableItem` DROP FOREIGN KEY `UserTimeTableItem_ibfk_2`

ALTER TABLE `ucalendar`.`UserTimeTableItem` DROP FOREIGN KEY `UserTimeTableItem_ibfk_3`

ALTER TABLE `ucalendar`.`TimeTable` DROP FOREIGN KEY `TimeTable_ibfk_1`

ALTER TABLE `ucalendar`.`TimeTable` DROP COLUMN `userId`

CREATE TABLE `ucalendar`.`UserTimeTable` (
`userId` varchar(191)  NOT NULL ,
`timeTableId` int  NOT NULL ,
PRIMARY KEY (`userId`,`timeTableId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `ucalendar`.`UserTimeTable` ADD FOREIGN KEY (`userId`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`UserTimeTable` ADD FOREIGN KEY (`timeTableId`) REFERENCES `ucalendar`.`TimeTable`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `ucalendar`.`UserTimeTableItem`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200915103411..20200915103814
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 enum Role {
   ALUMN
@@ -15,22 +15,20 @@
 model TimeTable {
   id             Int                      @default(autoincrement()) @id
   semester       Boolean                  @default(true)
-  user           User                     @relation(fields: [userId], references: [uid])
-  userId         String
   timeTableItems TimeTableTimeTableItem[]
+  user           UserTimeTable[]
 }
 model User {
-  uid           String              @id
-  password      String
-  name          String?
-  lastName      String?
-  role          Role                @default(ALUMN)
-  subjects      UserSubject[]
-  timeTableItem UserTimeTableItem[]
-  timeTable     TimeTable[]
+  uid       String          @id
+  password  String
+  name      String?
+  lastName  String?
+  role      Role            @default(ALUMN)
+  subjects  UserSubject[]
+  timeTable UserTimeTable[]
 }
 model Degree {
   id       Int             @id
@@ -68,9 +66,8 @@
   semester     Boolean                  @default(true)
   colorBg      String
   colorAbrev   String
   weeks        Json
-  users        UserTimeTableItem[]
   timetables   TimeTableTimeTableItem[]
   classRoom    ClassRoom                @relation(fields: [classRoomId], references: [id])
   classRoomId  Int
   group        Group                    @relation(fields: [groupId], references: [id])
@@ -95,16 +92,24 @@
   subjectId Int
   @@id([degreeId, subjectId])
 }
-model UserTimeTableItem {
-  user            User          @relation(fields: [userId], references: [uid])
-  userId          String
-  timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
-  timeTableItemId Int
-  @@id([userId, timeTableItemId])
+model UserTimeTable {
+  user        User      @relation(fields: [userId], references: [uid])
+  userId      String
+  timeTable   TimeTable @relation(fields: [timeTableId], references: [id])
+  timeTableId Int
+  @@id([userId, timeTableId])
 }
+// model UserTimeTableItem {
+//   user            User          @relation(fields: [userId], references: [uid])
+//   userId          String
+//   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
+//   timeTableItemId Int
+//   @@id([userId, timeTableItemId])
+// }
+
 model TimeTableTimeTableItem {
   timeTable       TimeTable     @relation(fields: [timeTableId], references: [id])
   timeTableId     Int
   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
```


