# Migration `20201010161428`

This migration has been generated by RubenZx at 10/10/2020, 6:14:28 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `ucalendar`.`Message` (
`id` int  NOT NULL  AUTO_INCREMENT,
`sentToUid` varchar(191)  NOT NULL ,
`sentFromUid` varchar(191)  NOT NULL ,
`content` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `ucalendar`.`Message` ADD FOREIGN KEY (`sentToUid`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`Message` ADD FOREIGN KEY (`sentFromUid`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200922094022..20201010161428
--- datamodel.dml
+++ datamodel.dml
@@ -3,49 +3,52 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 enum Role {
   ALUMN
   PROFESSOR
   ADMINISTRATOR
 }
-// model TimeTable {
-//   id             Int                      @default(autoincrement()) @id
-//   semester       Boolean                  @default(true)
-//   timeTableItems TimeTableTimeTableItem[]
-//   user           UserTimeTable[]
-// }
-
 model User {
-  uid            String               @id
-  password       String
-  name           String?
-  lastName       String?
-  role           Role                 @default(ALUMN)
-  subjects       UserSubject[]
-  timetableItems UserTimetableItems[]
-  // timeTables UserTimeTable[]
+  uid              String               @id
+  password         String
+  name             String?
+  lastName         String?
+  role             Role                 @default(ALUMN)
+  subjects         UserSubject[]
+  timetableItems   UserTimetableItems[]
+  messagesReceived Message[]            @relation("sentFrom")
+  messagesSent     Message[]            @relation("sentTo")
 }
+model Message {
+  id          Int    @id @default(autoincrement())
+  sentTo      User   @relation(fields: [sentToUid], references: [uid], name: "sentTo")
+  sentToUid   String
+  sentFrom    User   @relation(fields: [sentFromUid], references: [uid], name: "sentFrom")
+  sentFromUid String
+  content     String
+}
+
 model Degree {
   id       Int             @id
   name     String
   subjects DegreeSubject[]
 }
 model Group {
-  id            Int             @default(autoincrement()) @id
+  id            Int             @id @default(autoincrement())
   name          String          @unique
   timeTableItem TimeTableItem[]
 }
 model ClassRoom {
-  id            Int             @default(autoincrement()) @id
+  id            Int             @id @default(autoincrement())
   name          String          @unique
   timeTableItem TimeTableItem[]
 }
@@ -59,9 +62,9 @@
   user          UserSubject[]
 }
 model TimeTableItem {
-  id           Int                  @default(autoincrement()) @id
+  id           Int                  @id @default(autoincrement())
   startHour    String
   endHour      String
   type         String
   dayOfTheWeek Int
@@ -75,46 +78,34 @@
   group        Group                @relation(fields: [groupId], references: [id])
   groupId      Int
   subject      Subject              @relation(fields: [subjectId], references: [id])
   subjectId    Int
+
   @@unique([classRoomId, dayOfTheWeek, startHour, endHour], name: "onlyOneClassRoom")
 }
 model UserSubject {
   user      User    @relation(fields: [userId], references: [uid])
   userId    String
   subject   Subject @relation(fields: [subjectId], references: [id])
   subjectId Int
+
   @@id([userId, subjectId])
 }
 model DegreeSubject {
   degree    Degree  @relation(fields: [degreeId], references: [id])
   degreeId  Int
   subject   Subject @relation(fields: [subjectId], references: [id])
   subjectId Int
+
   @@id([degreeId, subjectId])
 }
 model UserTimetableItems {
   user            User          @relation(fields: [userId], references: [uid])
   userId          String
   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
   timeTableItemId Int
+
   @@id([userId, timeTableItemId])
 }
-
-// model UserTimeTable {
-//   user        User      @relation(fields: [userId], references: [uid])
-//   userId      String
-//   timeTable   TimeTable @relation(fields: [timeTableId], references: [id])
-//   timeTableId Int
-//   @@id([userId, timeTableId])
-// }
-
-// model TimeTableTimeTableItem {
-//   timeTable       TimeTable     @relation(fields: [timeTableId], references: [id])
-//   timeTableId     Int
-//   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
-//   timeTableItemId Int
-//   @@id([timeTableId, timeTableItemId])
-// }
```


