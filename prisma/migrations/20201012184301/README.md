# Migration `20201012184301`

This migration has been generated by RubenZx at 10/12/2020, 8:43:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `Message` DROP FOREIGN KEY `Message_ibfk_1`

ALTER TABLE `Message` DROP FOREIGN KEY `Message_ibfk_2`

ALTER TABLE `User` DROP FOREIGN KEY `User_ibfk_1`

ALTER TABLE `Message` DROP COLUMN `threadId`,
    DROP COLUMN `userUid`,
    ADD COLUMN `sentToUid` varchar(191)  NOT NULL ,
    ADD COLUMN `sentFromUid` varchar(191)  NOT NULL 

ALTER TABLE `User` DROP COLUMN `threadId`

ALTER TABLE `Message` ADD FOREIGN KEY (`sentToUid`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Message` ADD FOREIGN KEY (`sentFromUid`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `Thread`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201012183852..20201012184301
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 enum Role {
   ALUMN
@@ -13,34 +13,27 @@
   ADMINISTRATOR
 }
 model User {
-  uid            String               @id
-  password       String
-  name           String?
-  lastName       String?
-  role           Role                 @default(ALUMN)
-  subjects       UserSubject[]
-  timetableItems UserTimetableItems[]
-  Thread         Thread?              @relation(fields: [threadId], references: [id])
-  threadId       Int?
-  Message        Message[]
+  uid              String               @id
+  password         String
+  name             String?
+  lastName         String?
+  role             Role                 @default(ALUMN)
+  subjects         UserSubject[]
+  timetableItems   UserTimetableItems[]
+  messagesReceived Message[]            @relation("sentFrom")
+  messagesSent     Message[]            @relation("sentTo")
 }
-model Thread {
-  id       Int       @id @default(autoincrement())
-  messages Message[]
-  users    User[]
-}
-
 model Message {
-  id         Int      @id @default(autoincrement())
-  content    String
-  sentDate   DateTime @default(now())
-  Thread     Thread   @relation(fields: [threadId], references: [id])
-  threadId   Int
-  sentByUser User     @relation(fields: [userUid], references: [uid])
-  userUid    String
+  id          Int      @id @default(autoincrement())
+  content     String
+  sentDate    DateTime @default(now())
+  sentTo      User     @relation(fields: [sentToUid], references: [uid], name: "sentTo")
+  sentToUid   String
+  sentFrom    User     @relation(fields: [sentFromUid], references: [uid], name: "sentFrom")
+  sentFromUid String
 }
 model Degree {
   id       Int             @id
```


