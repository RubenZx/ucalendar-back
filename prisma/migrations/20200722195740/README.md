# Migration `20200722195740`

This migration has been generated by RubenZx at 7/22/2020, 7:57:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `ucalendar`.`TimeTable` (
`id` int NOT NULL  AUTO_INCREMENT,
`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`User` (
`id` int NOT NULL  AUTO_INCREMENT,
`lastName` varchar(191)   ,
`name` varchar(191)   ,
`password` varchar(191) NOT NULL  ,
`role` ENUM('ALUMN', 'PROFESSOR', 'ADMINISTRATOR') NOT NULL DEFAULT 'ALUMN' ,
`uid` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`Degree` (
`id` int NOT NULL  ,
`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`Subject` (
`abrev` varchar(191) NOT NULL  ,
`id` int NOT NULL  ,
`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`TimeTableItem` (
`classRoom` varchar(191) NOT NULL  ,
`colorAbrev` varchar(191) NOT NULL  ,
`colorBgc` varchar(191) NOT NULL  ,
`dayOfTheWeek` int NOT NULL  ,
`endHour` varchar(191) NOT NULL  ,
`id` int NOT NULL  AUTO_INCREMENT,
`startHour` varchar(191) NOT NULL  ,
`subjectId` int NOT NULL ,
`type` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`DegreeSubject` (
`degreeId` int NOT NULL ,
`subjectId` int NOT NULL ,
    PRIMARY KEY (`degreeId`,`subjectId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`UserTimeTableItem` (
`timeTableItemId` int NOT NULL ,
`userId` int NOT NULL ,
    PRIMARY KEY (`userId`,`timeTableItemId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`TimeTableSubject` (
`timeTableId` int NOT NULL ,
`timeTableItemId` int NOT NULL ,
    PRIMARY KEY (`timeTableId`,`timeTableItemId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ucalendar`.`Group` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL  ,
`timeTableItemId` int NOT NULL ,
`weeks` json NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `TimeTable_userId` ON `ucalendar`.`TimeTable`(`userId`)

CREATE UNIQUE INDEX `User.uid` ON `ucalendar`.`User`(`uid`)

CREATE UNIQUE INDEX `classRoom` ON `ucalendar`.`TimeTableItem`(`classRoom`,`dayOfTheWeek`,`startHour`,`endHour`)

ALTER TABLE `ucalendar`.`TimeTable` ADD FOREIGN KEY (`userId`) REFERENCES `ucalendar`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`TimeTableItem` ADD FOREIGN KEY (`subjectId`) REFERENCES `ucalendar`.`Subject`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`DegreeSubject` ADD FOREIGN KEY (`degreeId`) REFERENCES `ucalendar`.`Degree`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`DegreeSubject` ADD FOREIGN KEY (`subjectId`) REFERENCES `ucalendar`.`Subject`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`UserTimeTableItem` ADD FOREIGN KEY (`userId`) REFERENCES `ucalendar`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`UserTimeTableItem` ADD FOREIGN KEY (`timeTableItemId`) REFERENCES `ucalendar`.`TimeTableItem`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`TimeTableSubject` ADD FOREIGN KEY (`timeTableId`) REFERENCES `ucalendar`.`TimeTable`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`TimeTableSubject` ADD FOREIGN KEY (`timeTableItemId`) REFERENCES `ucalendar`.`TimeTableItem`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`Group` ADD FOREIGN KEY (`timeTableItemId`) REFERENCES `ucalendar`.`TimeTableItem`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200722195740
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,102 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+enum Role {
+  ALUMN
+  PROFESSOR
+  ADMINISTRATOR
+}
+
+model TimeTable {
+  id       Int                @default(autoincrement()) @id
+  user     User               @relation(fields: [userId], references: [id])
+  userId   Int
+  subjects TimeTableSubject[]
+}
+
+model User {
+  uid       String              @unique
+  id        Int                 @default(autoincrement()) @id
+  password  String
+  name      String?
+  lastName  String?
+  role      Role                @default(ALUMN)
+  timeTable TimeTable?
+  subjects  UserTimeTableItem[]
+}
+
+model Degree {
+  id       Int             @id
+  name     String
+  subjects DegreeSubject[]
+}
+
+model Subject {
+  id            Int             @id
+  name          String
+  abrev         String
+  degrees       DegreeSubject[]
+  timeTableItem TimeTableItem[]
+}
+
+model TimeTableItem {
+  id           Int                 @default(autoincrement()) @id
+  startHour    String
+  endHour      String
+  classRoom    String
+  type         String
+  dayOfTheWeek Int
+  colorBgc     String
+  colorAbrev   String
+  groups       Group[]
+  users        UserTimeTableItem[]
+  timetables   TimeTableSubject[]
+  subject      Subject             @relation(fields: [subjectId], references: [id])
+  subjectId    Int
+  @@unique([classRoom, dayOfTheWeek, startHour, endHour], name: "classRoom")
+}
+
+model DegreeSubject {
+  degree    Degree  @relation(fields: [degreeId], references: [id])
+  degreeId  Int
+  subject   Subject @relation(fields: [subjectId], references: [id])
+  subjectId Int
+  @@id([degreeId, subjectId])
+}
+
+model UserTimeTableItem {
+  user            User          @relation(fields: [userId], references: [id])
+  userId          Int
+  timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
+  timeTableItemId Int
+  @@id([userId, timeTableItemId])
+}
+
+model TimeTableSubject {
+  timeTable       TimeTable     @relation(fields: [timeTableId], references: [id])
+  timeTableId     Int
+  timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
+  timeTableItemId Int
+  @@id([timeTableId, timeTableItemId])
+}
+
+model Group {
+  id              Int           @default(autoincrement()) @id
+  name            String
+  weeks           Json
+  TimeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
+  timeTableItemId Int
+}
+
+// model Week {
+//   id      Int    @default(autoincrement()) @id
+//   week    Int
+//   group   Group? @relation(fields: [groupId], references: [id])
+//   groupId Int?
+// }
```


