# Migration `20200806171726`

This migration has been generated by RubenZx at 8/6/2020, 5:17:26 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX `classRoom` ON `ucalendar`.`TimeTableItem`

CREATE TABLE `ucalendar`.`ClassRoom` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `ucalendar`.`TimeTableItem` DROP COLUMN `classRoom`,
ADD COLUMN `classRoomId` int NOT NULL ;

CREATE UNIQUE INDEX `ClassRoom.name` ON `ucalendar`.`ClassRoom`(`name`)

CREATE UNIQUE INDEX `classRoom` ON `ucalendar`.`TimeTableItem`(`classRoomId`,`dayOfTheWeek`,`startHour`,`endHour`)

ALTER TABLE `ucalendar`.`TimeTableItem` ADD FOREIGN KEY (`classRoomId`) REFERENCES `ucalendar`.`ClassRoom`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200725172147..20200806171726
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 enum Role {
   ALUMN
@@ -41,8 +41,14 @@
   name          String          @unique
   timeTableItem TimeTableItem[]
 }
+model ClassRoom {
+  id            Int             @default(autoincrement()) @id
+  name          String          @unique
+  timeTableItem TimeTableItem[]
+}
+
 model Subject {
   id            Int             @id
   name          String
   abrev         String
@@ -53,21 +59,22 @@
 model TimeTableItem {
   id           Int                 @default(autoincrement()) @id
   startHour    String
   endHour      String
-  classRoom    String
   type         String
   dayOfTheWeek Int
   colorBgc     String
   colorAbrev   String
   weeks        Json
   users        UserTimeTableItem[]
   timetables   TimeTableSubject[]
+  classRoom    ClassRoom           @relation(fields: [classRoomId], references: [id])
+  classRoomId  Int
   group        Group               @relation(fields: [groupId], references: [id])
   groupId      Int
   subject      Subject             @relation(fields: [subjectId], references: [id])
   subjectId    Int
-  @@unique([classRoom, dayOfTheWeek, startHour, endHour], name: "classRoom")
+  @@unique([classRoomId, dayOfTheWeek, startHour, endHour], name: "classRoom")
 }
 model DegreeSubject {
   degree    Degree  @relation(fields: [degreeId], references: [id])
```


