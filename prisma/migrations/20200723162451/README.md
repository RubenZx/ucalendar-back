# Migration `20200723162451`

This migration has been generated by RubenZx at 7/23/2020, 4:24:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX `User.uid` ON `ucalendar`.`User`

ALTER TABLE `ucalendar`.`TimeTable` DROP FOREIGN KEY `TimeTable_ibfk_1`

ALTER TABLE `ucalendar`.`UserTimeTableItem` DROP FOREIGN KEY `UserTimeTableItem_ibfk_1`

ALTER TABLE `ucalendar`.`TimeTable` MODIFY `userId` varchar(191) NOT NULL  ;

ALTER TABLE `ucalendar`.`User` DROP PRIMARY KEY,
DROP COLUMN `id`,
ADD PRIMARY KEY (`uid`);

ALTER TABLE `ucalendar`.`UserTimeTableItem` DROP PRIMARY KEY,
MODIFY `userId` varchar(191) NOT NULL  ,
ADD PRIMARY KEY (`userId`, `timeTableItemId`);

ALTER TABLE `ucalendar`.`TimeTable` ADD FOREIGN KEY (`userId`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`UserTimeTableItem` ADD FOREIGN KEY (`userId`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200722202654..20200723162451
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 enum Role {
   ALUMN
@@ -14,16 +14,15 @@
 }
 model TimeTable {
   id       Int                @default(autoincrement()) @id
-  user     User               @relation(fields: [userId], references: [id])
-  userId   Int
+  user     User               @relation(fields: [userId], references: [uid])
+  userId   String
   subjects TimeTableSubject[]
 }
 model User {
-  uid       String              @unique
-  id        Int                 @default(autoincrement()) @id
+  uid       String              @id
   password  String
   name      String?
   lastName  String?
   role      Role                @default(ALUMN)
@@ -53,13 +52,13 @@
   type         String
   dayOfTheWeek Int
   colorBgc     String
   colorAbrev   String
-  group        Group               @relation(fields: [groupId], references: [id])
-  groupId      Int
   weeks        Json
   users        UserTimeTableItem[]
   timetables   TimeTableSubject[]
+  group        Group               @relation(fields: [groupId], references: [id])
+  groupId      Int
   subject      Subject             @relation(fields: [subjectId], references: [id])
   subjectId    Int
   @@unique([classRoom, dayOfTheWeek, startHour, endHour], name: "classRoom")
 }
@@ -72,10 +71,10 @@
   @@id([degreeId, subjectId])
 }
 model UserTimeTableItem {
-  user            User          @relation(fields: [userId], references: [id])
-  userId          Int
+  user            User          @relation(fields: [userId], references: [uid])
+  userId          String
   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
   timeTableItemId Int
   @@id([userId, timeTableItemId])
 }
@@ -92,11 +91,4 @@
   id            Int             @default(autoincrement()) @id
   name          String
   TimeTableItem TimeTableItem[]
 }
-
-// model Week {
-//   id      Int    @default(autoincrement()) @id
-//   week    Int
-//   group   Group? @relation(fields: [groupId], references: [id])
-//   groupId Int?
-// }
```


