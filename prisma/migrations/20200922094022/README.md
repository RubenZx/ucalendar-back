# Migration `20200922094022`

This migration has been generated by RubenZx at 9/22/2020, 11:40:22 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `ucalendar`.`TimeTableTimeTableItem` DROP FOREIGN KEY `TimeTableTimeTableItem_ibfk_1`

ALTER TABLE `ucalendar`.`TimeTableTimeTableItem` DROP FOREIGN KEY `TimeTableTimeTableItem_ibfk_2`

ALTER TABLE `ucalendar`.`UserTimeTable` DROP FOREIGN KEY `UserTimeTable_ibfk_2`

ALTER TABLE `ucalendar`.`UserTimeTable` DROP FOREIGN KEY `UserTimeTable_ibfk_1`

CREATE TABLE `ucalendar`.`UserTimetableItems` (
`userId` varchar(191)  NOT NULL ,
`timeTableItemId` int  NOT NULL ,
PRIMARY KEY (`userId`,`timeTableItemId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `ucalendar`.`UserTimetableItems` ADD FOREIGN KEY (`userId`) REFERENCES `ucalendar`.`User`(`uid`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ucalendar`.`UserTimetableItems` ADD FOREIGN KEY (`timeTableItemId`) REFERENCES `ucalendar`.`TimeTableItem`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `ucalendar`.`TimeTable`

DROP TABLE `ucalendar`.`TimeTableTimeTableItem`

DROP TABLE `ucalendar`.`UserTimeTable`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200921145654..20200922094022
--- datamodel.dml
+++ datamodel.dml
@@ -3,32 +3,33 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 enum Role {
   ALUMN
   PROFESSOR
   ADMINISTRATOR
 }
-model TimeTable {
-  id             Int                      @default(autoincrement()) @id
-  semester       Boolean                  @default(true)
-  timeTableItems TimeTableTimeTableItem[]
-  user           UserTimeTable[]
-}
+// model TimeTable {
+//   id             Int                      @default(autoincrement()) @id
+//   semester       Boolean                  @default(true)
+//   timeTableItems TimeTableTimeTableItem[]
+//   user           UserTimeTable[]
+// }
 model User {
-  uid        String          @id
-  password   String
-  name       String?
-  lastName   String?
-  role       Role            @default(ALUMN)
-  subjects   UserSubject[]
-  timeTables UserTimeTable[]
+  uid            String               @id
+  password       String
+  name           String?
+  lastName       String?
+  role           Role                 @default(ALUMN)
+  subjects       UserSubject[]
+  timetableItems UserTimetableItems[]
+  // timeTables UserTimeTable[]
 }
 model Degree {
   id       Int             @id
@@ -58,23 +59,23 @@
   user          UserSubject[]
 }
 model TimeTableItem {
-  id           Int                      @default(autoincrement()) @id
+  id           Int                  @default(autoincrement()) @id
   startHour    String
   endHour      String
   type         String
   dayOfTheWeek Int
-  semester     Boolean                  @default(true)
+  semester     Boolean              @default(true)
   colorBg      String
   colorAbrev   String
   weeks        Json
-  timetables   TimeTableTimeTableItem[]
-  classRoom    ClassRoom                @relation(fields: [classRoomId], references: [id])
+  users        UserTimetableItems[]
+  classRoom    ClassRoom            @relation(fields: [classRoomId], references: [id])
   classRoomId  Int
-  group        Group                    @relation(fields: [groupId], references: [id])
+  group        Group                @relation(fields: [groupId], references: [id])
   groupId      Int
-  subject      Subject                  @relation(fields: [subjectId], references: [id])
+  subject      Subject              @relation(fields: [subjectId], references: [id])
   subjectId    Int
   @@unique([classRoomId, dayOfTheWeek, startHour, endHour], name: "onlyOneClassRoom")
 }
@@ -93,19 +94,27 @@
   subjectId Int
   @@id([degreeId, subjectId])
 }
-model UserTimeTable {
-  user        User      @relation(fields: [userId], references: [uid])
-  userId      String
-  timeTable   TimeTable @relation(fields: [timeTableId], references: [id])
-  timeTableId Int
-  @@id([userId, timeTableId])
-}
-
-model TimeTableTimeTableItem {
-  timeTable       TimeTable     @relation(fields: [timeTableId], references: [id])
-  timeTableId     Int
+model UserTimetableItems {
+  user            User          @relation(fields: [userId], references: [uid])
+  userId          String
   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
   timeTableItemId Int
-  @@id([timeTableId, timeTableItemId])
+  @@id([userId, timeTableItemId])
 }
+
+// model UserTimeTable {
+//   user        User      @relation(fields: [userId], references: [uid])
+//   userId      String
+//   timeTable   TimeTable @relation(fields: [timeTableId], references: [id])
+//   timeTableId Int
+//   @@id([userId, timeTableId])
+// }
+
+// model TimeTableTimeTableItem {
+//   timeTable       TimeTable     @relation(fields: [timeTableId], references: [id])
+//   timeTableId     Int
+//   timeTableItem   TimeTableItem @relation(fields: [timeTableItemId], references: [id])
+//   timeTableItemId Int
+//   @@id([timeTableId, timeTableItemId])
+// }
```


